- [Créer un formulaire interactif sur vMap](#créer-un-formulaire-interactif-sur-vmap)
  - [1. Créer une table](#1-créer-une-table)


# Créer un formulaire interactif sur vMap
## 1. Créer une table 
1. Créer une table avec au minimum une colonne id et geom
   ```
    CREATE TABLE IF NOT EXISTS data_demo_vmap.incident_voirie
    (
        id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
        geom geometry(Geometry,2154) NOT NULL,
        insee integer NOT NULL,
        nom_c character varying COLLATE pg_catalog."default" NOT NULL,
        addr_localisation character varying COLLATE pg_catalog."default" NOT NULL,
        num_pacr integer,
        type_probleme character varying COLLATE pg_catalog."default" NOT NULL,
        description character varying COLLATE pg_catalog."default",
        date_incident date NOT NULL DEFAULT now(),
        etat character varying COLLATE pg_catalog."default" NOT NULL,
        date_fin date,
        photo text COLLATE pg_catalog."default",
        CONSTRAINT controle_pkey PRIMARY KEY (id)
    )
   ```
2. Créer les 3 règles de base (insert, updata, delete)
    ```
    1.CREATE RULE r_delete_incident AS
    ON DELETE TO data_demo_vmap.v_incident
    DO INSTEAD
    (DELETE FROM data_demo_vmap.incident_voirie
      WHERE (incident_voirie.id = old.id));
    ```
    ```
    2.CREATE RULE r_insert_incident AS
    ON INSERT TO data_demo_vmap.v_incident
    DO INSTEAD
    (INSERT INTO data_demo_vmap.incident_voirie (geom, insee, nom_c, addr_localisation, num_pacr, type_probleme, description, photo, etat, date_incident, date_fin)
      VALUES (new.geom, new.insee, new.nom_c, new.addr_localisation, new.num_pacr, new.type_probleme, new.description, new.photo, new.etat, new.date_incident, new.date_fin));

    ```
    ```
    3.CREATE RULE r_update_incident AS
    ON UPDATE TO data_demo_vmap.v_incident
    DO INSTEAD
    (UPDATE data_demo_vmap.incident_voirie SET id = incident_voirie.id, geom = incident_voirie.geom, insee = new.insee, nom_c = new.nom_c, addr_localisation = new.addr_localisation, num_pacr = new.num_pacr, type_probleme = new.type_probleme, description = new.description, photo = new.photo, etat = new.etat, date_incident = new.date_incident, date_fin = new.date_fin, date_update = CURRENT_TIMESTAMP);
   ```
   
## 2. Créer une couche avec cette table dans vMap
## 3. Créer les formulaires de saisie, d'édition et de visualisation


## Erreurs rencontrées
1. `Query Accessor : can't insert this object : An exception occurred while executing a query: SQLSTATE[XX000]: Internal error: 7 ERREUR:  ST_Transform: 0 is an invalid target SRID `
2. `msWMSDispatch(): WMS server error. WMS request not enabled. Check wms/ows_enable_request settings.` (Sur un WMS)
3. `GET < URL d'une couche > net::ERR_CERT_AUTHORITY_INVALID
main.019578c760dbad23.js:254970 EncodingError: The source image cannot be decoded.`

## Résolutions
 ```
1. ALTER TABLE <votre table>
ALTER COLUMN geom TYPE geometry(Geometry, 2154)
USING ST_SetSRID(geom, 2154);

2. Mettre une symbologie sur la couche.

3. Allez dans un nouvel onglet, rentrer l'URL et retourner sur vMap puis l'actualiser.
```
